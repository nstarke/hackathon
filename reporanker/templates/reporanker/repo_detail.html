{% extends 'reporanker/base.html' %}
{% load staticfiles %}

{% block body_content %}
  <div class="detail-container">
    <div class="detail-header">
      <p><span class="detail-name"><a href="{{ object.html_url }}">{{ object.name }}</a></span> <span class="detail-description">- {{object.description}}</span></p>
    </div>

    <div class="detail-body">
      Owner: {{ object.owner_name }}<br/>
      Language: {{ object.language }}<br/>
      {% if object.get_average_octocats %}
      Octocats: {{ object.get_average_octocats }}<br/>
      {% endif %}
      <div>
        <span class="octocon octocon-stars"></span> {{ object.star_count }}
        <span class="octocon octocon-eye-watch"></span> {{ object.watchers_count }}
        <span class="octocon octocon-forks"></span>  {{ object.forks_count }}
        <span class="octocon octocon-issues"></span> {{ object.open_issue_count }}
      </div>
      <div class="octo-icon-detail">
        {% if average_octocats %}
          <span><img src="{% static 'reporanker/img/octo_32_black.png' %}" alt="octo_cat">= {{average_octocats}}</p></span>
        {% endif %}
      </div>
    </div>
  </div>

    {% if not user_reviewed %}
    <div class="detail-review-none">
      <p>There are no reviews yet <a href="{% url 'repo-review-view' object.id %}">Click to be the first!  </a></p>
    </div>
    {% endif %}

    {% for review in object.ordered_review_set.all|slice:":10" %}
      <div class="detail-review">
        <strong>Reviewer:</strong> {{review.user}}<br/>
        <strong>Octocat Rating:</strong> {{review.octocats}}<br/>
        <strong>Comment:</strong> {{review.comment}}<br/>
        {% if not review.reviewopinion_set.all %}
            <button id='upvote' name='upvote' onclick='vote("up", {{review.pk}})'>Upvote</button>
            &nbsp;
            <button id='downvote' name='downvote' onclick='vote("down", {{review.pk}});'>Downvote</button>
        {% endif %}
        {% for opinion in review.reviewopinion_set.all %}
          {% if opinion %}
            {% if not opinion.helpful %}
              <button id='upvote' name='upvote' onclick='vote("up", {{review.pk}})'>Upvote</button>
            {% else %}
              <button id='downvote' name='downvote' onclick='vote("down", {{review.pk}});'>Downvote</button>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    {% endfor %}
    <script type="text/javascript">
      var token = '{{csrf_token}}';
      var vote = function(vote_verb, review){
        $.ajax({
          type: "POST",
          url: "/repo/rep/",
          data: {
            "vote": vote_verb,
            "review": review,
            "csrfmiddlewaretoken": token
          },
          success: function(response){
            if(response.vote === true){
              $("#upvote").hide();
            }else{
              $("#downvote").hide();
            };
          }
        });
      };
    </script>

{% endblock %}
